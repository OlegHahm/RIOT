From 07dcbec944ee1e9282f981fc09e950ff413e47f5 Mon Sep 17 00:00:00 2001
From: Oleg Hahm <oleg@hobbykeller.org>
Date: Tue, 14 Jul 2015 20:25:25 +0200
Subject: [PATCH 09/12] configure the node's role as paramater

replacing the macro solution
---
 openstack/cross-layers/idmanager.c | 31 +++++++++++++------------------
 openstack/cross-layers/idmanager.h |  2 +-
 openstack/openstack.c              |  4 ++--
 openstack/openstack.h              |  2 +-
 4 files changed, 17 insertions(+), 22 deletions(-)

diff --git a/openstack/cross-layers/idmanager.c b/openstack/cross-layers/idmanager.c
index e04aaa2..6545535 100644
--- a/openstack/cross-layers/idmanager.c
+++ b/openstack/cross-layers/idmanager.c
@@ -10,24 +10,19 @@
 
 idmanager_vars_t idmanager_vars;
 
-//=========================== prototypes ======================================
-
-//=========================== public ==========================================
-
-void idmanager_init(void) {
-   
-   // reset local variables
-   memset(&idmanager_vars, 0, sizeof(idmanager_vars_t));
-   
-   // isDAGroot
-#ifdef DAGROOT
-   idmanager_vars.isDAGroot            = TRUE;
-#else
-   idmanager_vars.isDAGroot            = FALSE;
-#endif
-   
-   // myPANID
-   idmanager_vars.myPANID.type         = ADDR_PANID;
+//=========================== prototypes ======================================
+
+//=========================== public ==========================================
+void idmanager_init(uint8_t role) {
+
+   // reset local variables
+   memset(&idmanager_vars, 0, sizeof(idmanager_vars_t));
+
+   // isDAGroot
+   idmanager_vars.isDAGroot            = role;
+
+   // myPANID
+   idmanager_vars.myPANID.type         = ADDR_PANID;
    idmanager_vars.myPANID.panid[0]     = 0xca;
    idmanager_vars.myPANID.panid[1]     = 0xfe;
    
diff --git a/openstack/cross-layers/idmanager.h b/openstack/cross-layers/idmanager.h
index 26bfc04..a99d8c2 100644
--- a/openstack/cross-layers/idmanager.h
+++ b/openstack/cross-layers/idmanager.h
@@ -42,7 +42,7 @@ typedef struct {
 
 //=========================== prototypes ======================================
 
-void         idmanager_init(void);
+void         idmanager_init(uint8_t role);
 bool         idmanager_getIsDAGroot(void);
 void         idmanager_setIsDAGroot(bool newRole);
 open_addr_t* idmanager_getMyID(uint8_t type);
diff --git a/openstack/openstack.c b/openstack/openstack.c
index 8e75b1c..6feb828 100644
--- a/openstack/openstack.c
+++ b/openstack/openstack.c
@@ -48,7 +48,7 @@
 
 //=========================== private =========================================
 
-void openstack_init(void) {
+void openstack_init(uint8_t role) {
    DEBUG("%s\n",__PRETTY_FUNCTION__);
    
    //===== drivers
@@ -56,7 +56,7 @@ void openstack_init(void) {
    
    //===== stack
    //-- cross-layer
-   idmanager_init();    // call first since initializes EUI64 and isDAGroot
+   idmanager_init(role);    // call first since initializes EUI64 and isDAGroot
    openqueue_init();
    openrandom_init();
    opentimers_init();
diff --git a/openstack/openstack.h b/openstack/openstack.h
index 55042df..bde13b7 100644
--- a/openstack/openstack.h
+++ b/openstack/openstack.h
@@ -17,6 +17,6 @@
 
 //=========================== prototypes ======================================
 
-void openstack_init(void);
+void openstack_init(uint8_t role);
 
 #endif
-- 
2.4.5

